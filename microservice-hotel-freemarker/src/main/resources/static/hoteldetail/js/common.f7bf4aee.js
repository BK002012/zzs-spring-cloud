(function(){var e,t,a,n,i,s,r,o,l,c,p;this.N=this.ndoo||(this.ndoo={}),n=this.ndoo,i=n.vars,t=this._,e="1019",o="lib",r="js",p="template",c=location.host,s="",t.indexOf(i.currentDomain,c)<0&&(s="/hotels"),a=function(t){var a;return a=t.indexOf("?")>-1?s+("/Content/"+t+"&CV="+e):s+("/Content/"+t+"?CV="+e),i.useCDN&&i.fileVersionMap&&(i.fileVersionMap[t]?a=i.CDNPrefix+i.fileVersionMap[t]:console&&null!==console&&console.error("path error!")),a},n.func&&(n.func.getFilePath=a),Do.setConfig("autoLoad",!1),l=[],Do.define("jquery",{path:a(o+"/jquery/jquery-1.11.3.min.js"),type:"js"}),Do.define("jquery.placeholder",{path:a(o+"/jquery/jquery.placeholder.min.js"),type:"js",requires:["jquery"]}),Do.define("jquery.datepicker_structure",{path:a(o+"/jquery/datepicker/jquery-ui.structure.css"),type:"css"}),Do.define("jquery.datepicker_theme",{path:a(o+"/jquery/datepicker/jquery-ui.theme.css"),type:"css"}),Do.define("jquery.ui",{path:a(o+"/jquery/datepicker/jquery-ui.min.js"),type:"js"}),Do.define("jquery.datepicker",{path:a(o+"/jquery/datepicker/datepicker-zh-CN.js"),type:"js",requires:["jquery.datepicker_structure","jquery.datepicker_theme","jquery","jquery.ui"]}),Do.define("jquery.cookie",{path:a(o+"/jquery/jquery.cookie-1.4.1.min.js"),type:"js",requires:["jquery"]}),Do.define("jquery.ntabs",{path:a(o+"/jquery/ntabs.js"),type:"js",requires:["jquery"]}),Do.define("jquery.tinyscrollbar_theme",{path:a(o+"/jquery/tinyscrollbar.css"),type:"css"}),Do.define("jquery.tinyscrollbar",{path:a(o+"/jquery/jquery.tinyscrollbar.min.js"),type:"js",requires:["jquery.tinyscrollbar_theme","jquery"]}),Do.define("jquery.qrcode",{path:a(o+"/jquery/jquery.qrcode.min.js"),type:"js",requires:["jquery"]}),Do.define("underscore",{path:a(o+"/backbone/underscore-min.js"),type:"js"}),Do.define("backbone",{path:a(o+"/backbone/backbone-min.js"),type:"js",requires:["underscore"]}),Do.define("sea",{path:a(o+"/sea/sea.js"),type:"js"}),Do.define("ndoo",{path:a(o+"/ndoo/ndoo.js"),type:"js"}),Do.define("ndoo_block",{path:a(o+"/ndoo/ndoo_block.js"),type:"js"}),Do.define("ndoo_util",{path:a(o+"/ndoo/util.js"),type:"js"}),Do.define("commonFunc",{path:a(r+"/commonFunc.js"),type:"js"}),Do.define("hzweb",{path:a(r+"/hzweb.js"),type:"js"}),Do.define("lazyload",{path:a(r+"/lazyload.js"),type:"js"}),Do.define("hotel",{path:a(r+"/mainApp.js"),type:"js"}),Do.define("mainBlock",{path:a(r+"/mainBlock.js"),type:"js"}),n.on("NBLOCK_DEFINE",function(){return n.setApp("hotel")}),l.push("jquery","underscore","backbone","commonFunc","hzweb"),Do.define("ui.checkinDate",{path:a(r+"/mainBlock.js"),type:"js"}),Do.define("CommonCheckinCityTemplate",{path:a(p+"/Common/CheckinCityTemplate.js"),type:"js"}),Do.define("CommonCheckinCitySuggestTemplate",{path:a(p+"/Common/CheckinCitySuggestTemplate.js"),type:"js"}),Do.define("ui.checkinCity",{path:a(r+"/ui/checkinCity.js"),type:"js",requires:["CommonCheckinCityTemplate","CommonCheckinCitySuggestTemplate"]}),Do.define("CommonCheckinKeywordTemplate",{path:a(p+"/Common/CheckinKeywordTemplate.js"),type:"js"}),Do.define("CommonCheckinKeySuggestTemplate",{path:a(p+"/Common/CheckinKeySuggestTemplate.js"),type:"js"}),Do.define("ui.checkinCityFixed",{path:a(r+"/ui/checkinCityFixed.js"),type:"js",requires:["CommonCheckinCityTemplate","CommonCheckinCitySuggestTemplate"]}),Do.define("CommonCheckinCityFixedTemplate",{path:a(p+"/Common/CheckinCityFixedTemplate.js"),type:"js"}),Do.define("ui.checkinKeyword",{path:a(r+"/ui/checkinKeyword.js"),type:"js",requires:["CommonCheckinKeywordTemplate","CommonCheckinKeySuggestTemplate","CommonCheckinCityFixedTemplate"]}),Do.define("block.hotelListMap",{path:a(r+"/mainBlock.js"),type:"js"}),Do.define("block.hotelDetailMap",{path:a(r+"/mainBlock.js"),type:"js"}),Do.define("block.backToTop",{path:a(r+"/mainBlock.js"),type:"js"}),Do.define("ui.wideScreen",{path:a(r+"/mainBlock.js"),type:"js"}),Do.define("ui.searchBar",{path:a(r+"/mainBlock.js"),type:"js"}),Do.define("block.mapMainBox",{path:a(r+"/block/mapMainBox.js"),type:"js"}),Do.define("block.mapHotelList",{path:a(r+"/block/mapHotelList.js"),type:"js"}),Do.define("block.mapHotelFilter",{path:a(r+"/block/mapHotelFilter.js"),type:"js"}),Do.define("HotelDetailHotelDescriptionTemplate",{path:a(p+"/Hotel/Detail/HotelDescription.js"),type:"js"}),Do.define("HotelDetailNiceCommentTemplate",{path:a(p+"/Hotel/Detail/NiceComment.js"),type:"js"}),Do.define("HotelDetailNiceCommentOverseaTemplate",{path:a(p+"/Hotel/Detail/NiceCommentOversea.js"),type:"js"}),Do.define("HotelDetailHotelCommentsTemplate",{path:a(p+"/Hotel/Detail/HotelComments.js"),type:"js"}),Do.define("block.hotelDetailComment",{path:a(r+"/mainBlock.js"),type:"js"}),Do.define("HotelListHotelBoxTemplate",{path:a(p+"/Hotel/List/HotelBox.js"),type:"js"}),Do.define("HotelListHotelBoxOverseaTemplate",{path:a(p+"/Hotel/List/HotelBoxOversea.js"),type:"js"}),Do.define("HotelListRoomTypeTemplate",{path:a(p+"/Hotel/List/RoomType.js"),type:"js"}),Do.define("HotelListHotelBoxSaleTemplate",{path:a(p+"/Hotel/List/HotelBoxSale.js"),type:"js"}),Do.define("HotelListRoomTypeSaleTemplate",{path:a(p+"/Hotel/List/RoomTypeSale.js"),type:"js"}),Do.define("block.hotelListHotels",{path:a(r+"/mainBlock.js"),type:"js"}),Do.define("HotelDetailRoomTypeOverseaTemplate",{path:a(p+"/Hotel/Detail/RoomTypeOversea.js"),type:"js"}),Do.define("HotelDetailRoomTypeTemplate",{path:a(p+"/Hotel/Detail/RoomType.js"),type:"js"}),Do.define("block.hotelDetailRoom",{path:a(r+"/mainBlock.js"),type:"js"}),Do.define("ui.loading",{path:a(r+"/mainBlock.js"),type:"js"}),Do.define("HotelListSearchFilterListTemplate",{path:a(p+"/Hotel/List/searchFilterList.js"),type:"js"}),Do.define("block.hotelListFilter",{path:a(r+"/mainBlock.js"),type:"js",requires:["HotelListSearchFilterListTemplate"]}),Do.define("block.hotelUserInfo",{path:a(r+"/mainBlock.js"),type:"js"}),Do.define("block.headUserInfo",{path:a(r+"/mainBlock.js"),type:"js"}),Do.define("HotelListVisitedHotelItemTemplate",{path:a(p+"/Hotel/List/VisitedHotelItem.js"),type:"js"}),Do.define("block.visitedHotel",{path:a(r+"/block/visitedHotel.js"),type:"js",requires:["HotelListVisitedHotelItemTemplate"]}),Do.define("ui.error",{path:a(r+"/mainBlock.js"),type:"js"}),Do.define("block.trackCompatibleMode",{path:a(r+"/mainBlock.js"),type:"js"}),n.on("NBLOCK_DEFINE",function(){n.setBlock("ui.checkinDate"),n.setBlock("ui.checkinCity"),n.setBlock("ui.checkinCityFixed"),n.setBlock("ui.checkinKeyword"),n.setBlock("ui.wideScreen"),n.setBlock("ui.loading"),n.setBlock("ui.error"),n.setBlock("ui.searchBar"),n.setBlock("block.hotelListMap"),n.setBlock("block.hotelDetailMap"),n.setBlock("block.backToTop"),n.setBlock("block.mapMainBox"),n.setBlock("block.mapHotelList"),n.setBlock("block.mapHotelFilter"),n.setBlock("block.hotelDetailComment"),n.setBlock("block.hotelListHotels"),n.setBlock("block.hotelDetailRoom"),n.setBlock("block.hotelListFilter"),n.setBlock("block.hotelUserInfo"),n.setBlock("block.headUserInfo"),n.setBlock("block.visitedHotel"),n.setBlock("block.trackCompatibleMode")}),Do.setLoaded(l)}).call(this),function(){"use strict";var e,t,a,n,i,s,r;a=this._,e=this.jQuery||this.Zepto,t=this.Backbone,this.N=this.ndoo||(this.ndoo={}),i=this.ndoo,r=i.vars,n=i.func,s=i.storage,n.createPostRequest=function(t,n,i){var s,r,o;return null==i&&(i=!0),o='<form class="Ldn" action=\''+t+'\' method="post">\n<% _.each(data, function(value, key) { %>\n  <input type="hidden" name="<%-key%>" value="<%-value%>">\n<% }); %>\n</form>',r=a.template(o,{variable:"data"})(n),s=e(r).appendTo("body"),i?s.submit():s},n.getAjaxData=function(t,n,i){var s;s={url:t,cache:!1,traditional:!0,beforeSend:function(e){e.setRequestHeader("echoToken",Math.random()),e.setRequestHeader("__v_t",r.__v_t||"")},complete:function(e,t){n&&n(e,t)}},i&&(s=a.extend(s,i)),e.ajax(s)},n.getTemplate=function(t){var n,s;if(s=i.service("template"))return s.getTemplate(t);if(n=e("#"+t).html(),a.isString(n))return a.template(n,{variable:"data"});throw"template type error, id: "+t},n.renderTemplate=function(e,t){var a;return(a=n.getTemplate(e))(t)},n.addScript=function(e){var t,a;a=document.createElement("script"),a.setAttribute("type","text/javascript"),t=document.getElementById("scriptArea"),t?t.appendChild(a):document.body.appendChild(a),a.setAttribute("src",e),a=null},n.mapInstall=function(){var e;return!(window.google||window.AMap||s("mapInstall"))&&(window.mapInstallCallback=function(){return s("mapInstallSuccess",!0),i.trigger("STATUS:mapInstall")},e="google"===r.mapRenderType?r.gmapurl:r.mapurl,e+=e.indexOf("?")<0?"?":"&",n.addScript(e+"callback=mapInstallCallback"),s("mapInstall",r.mapRenderType||!0),void 0)},n.checkMapInstall=function(){return s("mapInstallSuccess")},n.getHotelStyleMarkIcon=function(e,t){var a,n,i,r,o,l;if("list"===t||"map"===t||"detail"===t||"map"===t){switch(e=parseInt(e),"oversea"===s("HOTELTYPE")||e>500&&720!==e&&920!==e?(i=ndoo.vars.mapMarkImageOversea,r=ndoo.vars.mapMarkSizeOversea):(i=ndoo.vars.mapMarkImage,r=ndoo.vars.mapMarkSize),e){case 1:n=7;break;case 2:n=3;break;case 3:case 320:n=6;break;case 4:n=2;break;case 5:case 540:n=4,i=ndoo.vars.mapMarkImage,r=ndoo.vars.mapMarkSize;break;case 6:n=5;break;case 7:case 720:n=8;break;case 8:n=9;break;case 9:case 920:n=10;break;case 420:n=2;break;case 13:n=14,i=ndoo.vars.mapMarkImage,r=ndoo.vars.mapMarkSize;break;case 15:n=15;break;case 14:n=16;break;case 16:n=17;break;case 27:n="oversea"===s("HOTELTYPE")?22:18;break;case 10:case 500:n="oversea"===s("HOTELTYPE")?16:13;break;case 501:n=7;break;case 502:n=17;break;case 503:n=6;break;case 504:n=2;break;case 505:n=19;break;case 506:n=4;break;case 507:n=3;break;case 508:n=20;break;case 509:n=18;break;case 510:n=5;break;case 511:n=14;break;case 512:n=11;break;case 513:n=15;break;case 514:n=8;break;case 515:n=13;break;case 516:n=12;break;case 517:n=10;break;default:n=1}return o=0,l=50*n-50,a={image:i,imageWidth:r[0],imageHeight:r[1],imageOffsetX:o,imageOffsetY:l,offsetX:18,offsetY:45,width:60,height:45}}},n.formatUrlParam=function(e){var t,n,i,s,r,o,l,c;for(null==e&&(e=""),e=e.replace(/^\?/,""),r={},l=e&&e.length>1?e.split("&"):[],t=0,s=l.length;t<s;t++)n=l[t],o=n.split("="),i=o[0],c=o[1],i&&(i=i.replace(/\[\]$/,""),c?(null!==c.match(/%u\w{4}/)&&(c=c.replace(/%u\w{4}/g,function(e){return unescape(e)})),c=decodeURIComponent(c)):c="",a.has(r,i)?a.isArray(r[i])?r[i].push(c):"checkindate"!==i.toLowerCase()&&"checkoutdate"!==i.toLowerCase()&&(r[i]=[r[i],c]):r[i]=c);return r},n.checkStatusCode=function(e,t,n){return"number"==typeof t?e>t&&e<300:"array"==typeof t?a.findIndex(t,e)>-1:void 0},n.checkSuccessStatus=function(e){return n.checkStatusCode(e,199,300)},n.getQueryHotelListMemberLevel=function(){var e;return e=i.service("user"),e.hasSigned()&&e.hasCompanyMemberLevel()?e.getMemberLevel():r.MemberLevel||""},n.trimHtmlSpace=function(e){return e=e.replace(/^\s|\s$/g,""),e.replace(/>\s+</g,"><")},n.setScrollTop=function(t){var a,n,i,s;return i=400,t<0&&(t=0),n=document,s=Math.max(n.body.scrollTop,n.documentElement.scrollTop),a=Math.abs(t-s),a>1e3&&(i=10*parseInt(a/1e3*40)),e("html, body").animate({scrollTop:t},i)},n.breakPointFn=function(){console.log("abc")}}.call(this);var TplHelper={renderScoreStar:function(e){var t="";e=null==e?5:parseFloat(e);for(var a=0;a<5;a++){var n=parseInt(e)-1,i=parseInt(e+.5);t+=a<=n?'<i class="Cicon star full"></i>':a==n+1&&n+1!=i?'<i class="Cicon star half"></i>':'<i class="Cicon star"></i>'}return t},parseDate:function(e){var t,a;return t=e.match(/\d+/),a=0,t&&t[0]&&(a=parseInt(t[0])),a},serverDateReg:/\/Date\((\d+)\)\//,parseCheckInDayTimeOversea:function(e){var t,a=this.serverDateReg.exec(e);return a?t=new Date((+a[1])):e&&(t=new Date(e.replace(/\-/g,"/").replace("T"," "))),t},getDisplayDate:function(e){var t;"object"!=typeof e?"string"==typeof e&&null!=e.match(/^\/Date/)?(t=new Date(this.parseDate(e)),TplHelper.parseDate):t=new Date(e):t=e;var a=+new Date-t.getTime(),n=a/1e3/60/60,i="",s=t.getHours();s/10<1&&(s="0"+s);var r=TplHelper.formatDate(t,"yyyy-MM-dd hh:mm");if(n>24)i=r;else if(n>=1)i=parseInt(n)+"小时前";else{var o=60*n;if(o>60)i=r;else if(o>=1)i=parseInt(o)+"分钟前";else{var l=60*o;i=o>60?r:o>=1?parseInt(l)+"秒前":r}}return i},getDisplayDate2:function(e){var t=new Date(e.CommentTime),a=+new Date-t.getTime(),n=a/1e3/60/60,i=n/24,s="",r=t.getHours();if(r/10<1&&(r="0"+r),i>7)s="7天";else if(i>1)s=parseInt(i)+"天前";else if(n>=1)s=parseInt(n)+"小时前";else{var o=60*n;if(o>=1)s=parseInt(o)+"分钟前";else{var l=60*o;o>=1&&(s=parseInt(l)+"秒前")}}return s},calculationBreakfast:function(e){var t="无";if(e&&e.length){var a=e[0];1==a.BreakfastCount?t="单早":2==a.BreakfastCount?t="双早":a.BreakfastCount>2&&(t=a.BreakfastCount+"份")}return t},calculationAverageMarketPrice:function(e){var t=0;if(e&&e.length){for(var a=0,n=0,i=e.length;n<i;n++)a+=e[n].MarketPrice||0;t=Math.ceil(a/i)}return t},calculationOverseaPrice:function(e){var t={};if(e&&e.length){t.codes=["CNY"];for(var a=0,n=e.length;a<n;a++){var i=e[a].Prices;_.each(i,function(e,a){var n=e.CurrencyCode,i=n+"Total",s=n+"Tax",r=e.Amount||0;_.isArray(t[n])?(t[i]+=r,t[n].push(r)):(t[n]=[r],t[i]=r,"CNY"!==n&&t.codes.push(n)),t[s]=(e.TaxAmount||0)+(t[s]?t[s]:0)})}}return t.len=e.length,t},calculationPrice:function(e,t,a){var n="";a=""+a;var i="",s=a.indexOf(".");if(s>0&&(i=a.substring(s+1,a.length)),a&&a.length)for(var r=-1,o=0;o<a.length;o++)if(o!=r){var l=a.charAt(o);i.indexOf(o.toString())>=0&&(n+='<var class="'+e+"_"+t+'_10" ></var>');var c="-"==l;if(c){var p=a.charAt(o+1);"1"==p&&(l="0",n+='<var class="'+e+"_"+t+"_"+l+'"></var>',r=o+1,o++,i.indexOf(o.toString())>=0&&(n+='<var class="'+e+"_"+t+'_10" ></var>')),"2"==p&&(l="10",n+='<var class="'+e+"_"+t+"_"+l+'"></var>',r=o+1,o++,i.indexOf(o.toString())>=0&&(n+='<var class="'+e+"_"+t+'_10" ></var>'))}s>-1&&o>=s||(l=a.charAt(c?o+1:o),n+='<var class="'+e+"_"+t+"_"+l+'"></var>',c&&(o++,i.indexOf(o.toString())>=0&&(n+='<var class="'+e+"_"+t+'_10" ></var>')))}return n},calculationAveragePaymentPrice:function(e){var t=0;if(e&&e.length){for(var a=0,n=0,i=e.length;n<i;n++)a+=e[n].Payment||0;t=Math.ceil(a/i)}return t},getValidImageUrl:function(e){return e&&null==e.match(/^(?:http|\/)/)&&(e="//"+e),e},formatDate:function(e,t){var a={"M+":e.getMonth()+1,"d+":e.getDate(),"h+":e.getHours()%12==0?12:e.getHours()%12,"H+":e.getHours(),"m+":e.getMinutes(),"s+":e.getSeconds(),"q+":Math.floor((e.getMonth()+3)/3),S:e.getMilliseconds()},n={0:"/u65e5",1:"/u4e00",2:"/u4e8c",3:"/u4e09",4:"/u56db",5:"/u4e94",6:"/u516d"};/(y+)/.test(t)&&(t=t.replace(RegExp.$1,(e.getFullYear()+"").substr(4-RegExp.$1.length))),/(E+)/.test(t)&&(t=t.replace(RegExp.$1,(RegExp.$1.length>1?RegExp.$1.length>2?"/u661f/u671f":"/u5468":"")+n[e.getDay()+""]));for(var i in a)new RegExp("("+i+")").test(t)&&(t=t.replace(RegExp.$1,1==RegExp.$1.length?a[i]:("00"+a[i]).substr((""+a[i]).length)));return t},getFirendlyDistance:function(e,t){var a="M",n="KM";return isNaN(parseInt(e))?e:(e=parseInt(e),"cn"==t&&(a="米",n="公里"),e<1e3?e+=a:(e=parseInt(e/100)/10,e+=n),e)},hotelLevelZh:{1:"一星级",2:"二星级",3:"三星级",4:"四星级",5:"五星级"},hotelLevelDesc:{2:"价廉",7:"中档",4:"奢华",13:"经济",14:"高端"},getHotelLevel:function(e,t,a){if(e<=0||e>5)return"";var n=[],i=new Array((+e)),s="yellow"===t?"small_medal_yellow":"small_medal_gold",r="";return _.each(i,function(){n.push('<i class="Cicon full '+s+'"></i>')}),r=n.join("")+'<span class="Ldib Lpl5">'+this.hotelLevelZh[e]+(this.hotelLevelDesc[a]?"/"+this.hotelLevelDesc[a]:"")+"</span>",n=null,i=null,r},getDetailPageUrl:function(e,t){return"PMS"==e.HotelSource||"HBooking"==e.HotelSource?t.DetailPagePrefix+"/"+e.HotelID+"?CheckInDate="+t.CheckInDate+"&CheckOutDate="+t.CheckOutDate:t.DetailPageOverseaPrefix?t.DetailPageOverseaPrefix+"/"+e.HotelID+"?HotelLevel="+e.HotelLevel+"&CheckInDate="+t.CheckInDate+"&CheckOutDate="+t.CheckOutDate:void 0},hotelChildTags:{320:"优品",420:"新品",720:"精品",920:"新品",540:"新品"}};(function(){"use strict";var e,t,a,n,i,s,r,o,l;i=this._,e=this.jQuery||this.Zepto,t=this.Backbone,s=this.ndoo,l=t.Model.extend({defaults:{signed:!1,memberId:"",memberName:"",memberLevel:"I",memberType:"persnal",isCompanyMember:!1,callback:null,favorHotels:null,syncFavor:!1,point:"0",isInfoIntegrity:!1,memberNewSystemNoticeCount:"0",memberImgUrl:"",memberLevelDesc:"",isAdmin:!1,isForever:!1},hasSigned:function(){return this.get("signed")},hasCompanyMemberLevel:function(e){return e||(e=this.get("memberLevel")),(","+(s.vars.CompanyMemberLevel||"")+",").indexOf(","+e+",")>-1},getMemberId:function(){return this.get("memberId")},getMemberLevel:function(){return this.get("memberLevel")},getMemberName:function(){return this.get("memberName")},getMemberType:function(){return this.get("memberType")},getMemberLevelDesc:function(){return this.get("memberLevelDesc")},getMemberNewSystemNoticeCount:function(){return this.get("memberNewSystemNoticeCount")},getMemberImgUrl:function(){return this.get("memberImgUrl")},getIsAdmin:function(){return this.get("isAdmin")},getIsForever:function(){return this.get("isForever")},getPoint:function(){return this.get("point")},getIsInfoIntegrity:function(){return this.get("isInfoIntegrity")},goHome:function(){s.vars.MemberCenterUrl&&(location.href=s.vars.MemberCenterUrl)},signIn:function(){var e,t;e=encodeURIComponent(location.href.replace(/#.*$/,"")),t=s.vars.signInUrl+e,location.href=t},signUp:function(){var e,t;e=encodeURIComponent(location.href.replace(/#.*$/,"")),t=s.vars.signUpUrl+e,location.href=t},signOut:function(){var e;e=location.href.replace(/\?.*$/,""),e=s.vars.signOutUrl+encodeURIComponent(e),location.href=e,s.trigger("USER_SIGNOUT")},syncUserInfo:function(t,a){var n;null==a&&(a="check"),n=s.vars.getUserInfoUrl,n+=n.indexOf("?")>-1?"&":"?",n+="PopupLogin=1&ST="+encodeURIComponent(t),s.func.getAjaxData(n,function(t){return function(a,n){var i;a.status>199&&a.status<300?a.responseJSON?n=a.responseJSON:a.responseText&&(n=e.parseJSON(a.responseText)):401===a.status||500===a.status,i=t.hasCompanyMemberLevel(n.MemberLevel)?"company":"persnal",t.set({signed:!0,memberId:n.MemberID,memberLevel:n.MemberLevel,memberName:n.MemberName,memberType:i,memberNewSystemNoticeCount:n.MemberNewSystemNoticeCount||"0",memberImgUrl:n.ImgUrl,memberLevelDesc:n.MemberLevelDesc,isInfoIntegrity:n.IsInfoIntegrity,point:n.Point,isAdmin:n.IsAdmin,isForever:n.IsForever}),"company"===i&&location.reload(),t.signInComplete()}}(this),{type:"POST"})},syncFavorHotels:function(){var t;this.get("syncFavor")&&(t=function(t,a){var n;s.func.checkSuccessStatus(t.status)&&(t.responseJSON?n=t.responseJSON:t.responseText&&(n=e.parseJSON(t.responseText))),n||(n={MemberUsualHotels:[]}),this.set("favorHotels",n.MemberUsualHotels),s.trigger("changeFavorHotels")},s.vars.getFavorHotelsUrl&&s.func.getAjaxData(s.vars.getFavorHotelsUrl,i.bind(t,this)))},checkSignState:function(){if(s.vars.checkSignUrl)return e.ajax({url:s.vars.checkSignUrl,type:"GET",dataType:"jsonp",success:function(e){return function(t){var a;t.Login&&(a=t.ST,e.syncUserInfo(a))}}(this)})},signInCancel:function(){var e;return e=null,this.set({callback:e})},signInComplete:function(){var e;e=this.get("callback"),e&&e(),this.set("callback",null),s.trigger("USER_SIGNIN"),this.syncFavorHotels()},signInPopup:function(e){return this.set({callback:e}),this.trigger("userSignInPopup")},signInPopupComplete:function(e){return this.syncUserInfo(e,"popup")},constructor:function(){var e;t.Model.apply(this,arguments),this.on("userSignInPopupCancel",this.signInCancel),this.on("userSignInPopupComplete",this.signInPopupComplete),s.vars.memberId?(e=this.hasCompanyMemberLevel(s.vars.currentMemberLevel)?"company":"persnal",this.set({signed:!0,memberId:s.vars.memberId,memberLevel:s.vars.currentMemberLevel,memberName:s.vars.memberName,memberType:e,memberNewSystemNoticeCount:s.vars.memberNewSystemNoticeCount||"0",memberImgUrl:s.vars.memberImgUrl||s.vars.defaultUserPhoto20x20,memberLevelDesc:s.vars.memberLevelDesc,point:s.vars.point,isInfoIntegrity:s.vars.isInfoIntegrity&&"True"===s.vars.isInfoIntegrity&&!0||!1,isAdmin:s.vars.isAdmin&&"True"===s.vars.isAdmin&&!0||!1,isForever:s.vars.isForever&&"True"===s.vars.isForever&&!0||!1}),this.syncFavorHotels()):this.checkSignState()}}),r=t.Model.extend({paramObject:{},parseDate:function(e){var t,a,n,i,s,r;return a=e.match(/\d+/),n=0,a&&a[0]&&(n=parseInt(a[0])),t=new Date(n),r=t.getFullYear(),s=t.getMonth()+1,i=t.getDate(),r+"-"+(s<10?"0":"")+s+"-"+(i<10?"0":"")+i},checkRequireParam:function(){var e;e=ndoo.vars.requestParams,e&&(this.paramObject.CityID||(this.paramObject.CityID=e.CityID),this.paramObject.CheckInDate||(this.paramObject.CheckInDate=this.parseDate(e.CheckInDate)),this.paramObject.CheckOutDate||(this.paramObject.CheckOutDate=this.parseDate(e.CheckOutDate)))},initParam:function(e){var t;e&&e.length>1&&(t=s.func.formatUrlParam(e.substr(1))),i.extend(this.paramObject,t)},setParam:function(e,t,a){a&&i.has(this.paramObject,e)?i.isArray(this.paramObject[e])?this.paramObject[e].push(t):this.paramObject[e]=[this.paramObject[e],t]:this.paramObject[e]=t},removeParam:function(e){i.has(this.paramObject,e)&&delete this.paramObject[e]},getParam:function(e){return e?i.has(this.paramObject,e)?this.paramObject[e]:"":this.paramObject},getHotelListCheckInParam:function(t,a){var n,s,r,o,l,c,p,d,m,u;return t||(t=e("#Plist_checkin")),o=t.find(".checkincity").data("cityId"),l=t.find(".checkincity").data("cityNameSpell"),s=t.find(".checkindate").val(),r=t.find(".checkoutdate").val(),c=t.find(".checkincity").data("citySource"),d=null!==c?{CityID:o,CityNameSpell:l,CheckInDate:s,CheckOutDate:r,CitySource:c}:{CityID:o,CityNameSpell:l,CheckInDate:s,CheckOutDate:r},n=t.find(".checkinkeyword"),p=n.val().replace(/^\s|\s$/g,""),p&&(d.Keyword=p,m=n.data("type"),m&&(u=n.data("value"),"Latlng"===m?(u=u.split("|"),d.Latitude=u[0],d.Longitude=u[1]):d[m]=u)),i.isObject(a)&&i.each(a,function(e,a){var n;return n=t.find("."+a).val(),n&&(d[e]=parseFloat(n))}),d},getMapSearchParam:function(){var e;return e=i.pick(this.paramObject,"CityID","CheckInDate","CheckOutDate","HotelStyleList","PriceRange","ActivityID","FacilityList","PageSize")},constructor:function(e){""!==e&&this.initParam(e),this.checkRequireParam()}}),o=t.Model.extend({defaults:{memberPricePopupTemplate:'<%\n  var _func = {\n    getMemberPriceData: function(data, level) {\n      price = false;\n      for (var i=0; i<data.length; i++) {\n        if (data[i].MemberLevel == level) {\n          price = data[i];\n          break;\n        }\n      }\n      return price;\n    }\n  }\n%>\n<table><tr>\n<% if (data.PriceList && data.PriceList) { %>\n  <% var memberLevelList = data.MemberLevelList.split(\',\').reverse(); %>\n  <% var startIndex = 0; %>\n  <% _.each(memberLevelList, function(level) { %>\n    <% var price = _func.getMemberPriceData(data.PriceList, level); %>\n    <% if (price) { %>\n    <td data-member-level="<%=price.MemberLevel%>" class="item<%=price.MemberLevel == data.MemberLevel ? \' active\':\'\'%><%= (startIndex > 0) ? \'\':\' first\'%>" width="50"><%-price.MemberLevelDescript%><br><span><i><%= (data.CurrencyCode.toLowerCase()=="hkd" ? "HKD" : "￥") %></i><%=TplHelper.calculationPrice("p12",price.MemberLevel == data.MemberLevel ? "0":"1",price.AveragePrice)%></span></td>\n    <% startIndex += 1; %>\n    <% } %>\n  <% }); %>\n<% } else if (data.loading) { %>\n<td class="loading">数据加载中...</td>\n<% } else { %>\n<td class="empty">暂无会员价格</td>\n<% } %></tr></table>',HotelDetailHotelImage:'<div class="Mpopup hotelimage">\n    <div class="inner Lposr">\n        <i class="Cicon middle_close"></i>\n        <div class="contentbox">\n            <div class="slides horizontalTab">\n                <ul class="tab_body">\n                    <% _.each(data.Images, function(img, index) { %>\n                    <% if(img.ImageType!=6){ %>\n                    <li>\n                      <div class="title"><%-img.ImageName%></div>\n                      <a href="javascript:;"><img src="<%=img.ImageURL%>.675-375.jpg" title="<%-img.ImageName%>"></a>\n                    </li>\n                    <% } %>\n                    <% }); %>\n                </ul>\n            </div>\n        </div>\n    </div>\n</div>',HotelDetailNearByHotel:'<% if (data) { %>\n<% _.each(data.HotelList, function(item, index) { %>\n<% if (item.HotelID == data.HotelId) { return; } %>\n<div class="hotel" data-longitude="<%=(item.Lng || 0)%>" data-latitude="<%=(item.Lat || 0)%>">\n    <img src="<%=item.HotelPhoto%>.175-130.jpg" width="94" height="70" class="hotelimg">\n    <div>\n        <a href="<%=data.DetailPagePrefix%>?HotelId=<%=item.HotelID%>&CheckInDate=<%=data.CheckInDate%>&CheckOutDate=<%=data.CheckOutDate%>" target="_blank" class="hotelname"><%-item.HotelName%></a>\n        <div class="address"><%-item.HotelAddress%></div>\n        <div class="info">\n            <span class="price"><i><%= (item.CurrencyCode.toLowerCase()=="hkd" ? "HKD" : "￥") %></i><%=TplHelper.calculationPrice("p16",0,item.HotelLowestPrice)%><i>起</i></span><span class="distance Lflr">距您当前位置 <i><%=TplHelper.getFirendlyDistance(item.Distance, \'cn\')%></i></span>\n        </div>\n    </div>\n</div>\n<% }); %>\n<% } else { %>\n<div class="empty">\n    暂无附近酒店\n</div>\n<% } %>',HotelCommonFullView:'<div class="Mpopup fullview Ldn">\n    <div class="inner Lposr">\n        <div class="top">\n            <i class="Cicon middle_close"></i>\n            <div class="title">360全景</div>\n        </div>\n        <div class="contentbox">\n            <iframe src="<%-data.url%>" frameborder="0" width="100%" height="600"></iframe>\n        </div>\n    </div>\n</div>',HotelCommonLoading:'<div class="Mpopup loading Ldn">\n    <div class="inner">\n        <div class="contentbox">\n            <div class="circle"></div><span class="info">正在加载中，请稍候</span>\n        </div>\n    </div>\n</div>',HotelCommonError:'<div style="display: block" class="Mpopup error">\n    <div class="popus-cont"><a href="javascript:;" class="close"></a>\n        <div class="c-cont">\n        <p><em class="error_img"></em><span class="error_intro"><%=data.message%></span></p>\n        </div>\n    </div>\n</div>',HotelCommonPage:'<%\n    var displayBackward = true;\n    var displayFirstPage = true;    \n    var displayUp1 = true;\n    var displayUp2 = true;\n    if(data.FirstIndex == data.CurrentIndex)\n    {\n        displayFirstPage = false;\n        displayBackward = false;\n\n        displayUp1 = false;\n        displayUp2 = false;\n    }\n    if(data.FirstIndex == data.CurrentIndex - 1)\n    {\n        displayFirstPage = false;\n\n        displayUp1 = false;\n    }\n\n    var displayForward = true;\n    var displayLastPage = true;\n    var displayDown1 = true;\n    var displayDown2 = true;\n    if(data.LastIndex == data.CurrentIndex)\n    {\n        displayLastPage = false;\n        displayForward = false;\n\n        displayDown1 = false;\n        displayDown2 = false;\n    }\n    if(data.LastIndex == data.CurrentIndex + 1)\n    {\n        displayLastPage = false;\n\n        displayDown1 = false;\n    }\n%>\n\n<% if(data.LastIndex >= data.FirstIndex) { %>\n\n<% if(displayFirstPage) { %>\n<a href="#" class="Lmr5" data-page-index="<%=data.FirstIndex%>">首页</a>\n<% } %>\n<% if(displayBackward) { %>\n<a href="#" class="Lmr5" data-page-index="<%=data.UpIndex%>">上一页</a>\n<% } %>\n\n<% if(displayUp1) { %>\n<a href="#" data-page-index="<%=data.CurrentIndex-2%>"><%=data.CurrentIndex-2%></a>\n<% } %>\n<% if(displayUp2) { %>\n<a href="#" data-page-index="<%=data.CurrentIndex-1%>"><%=data.CurrentIndex-1%></a>\n<% } %>\n\n<a href="#" class="active" data-page-index="<%=data.CurrentIndex%>"><%=data.CurrentIndex%></a>\n\n<% if(displayDown2) { %>\n<a href="#" data-page-index="<%=data.CurrentIndex+1%>"><%=data.CurrentIndex+1%></a>\n<% } %>\n<% if(displayDown1) { %>\n<a href="#" data-page-index="<%=data.CurrentIndex+2%>"><%=data.CurrentIndex+2%></a>\n<% } %>\n\n<% if(displayForward) { %>\n<a href="#" class="needspace" data-page-index="<%=data.DownIndex%>">下一页</a>\n<% } %>\n<% if(displayLastPage) { %>\n<a href="#" class="needspace" data-page-index="<%=data.LastIndex%>">尾页</a>\n<% } %>\n\n<% } %>',userSignInTemplate:'<div id="IframPopups" class="Mpopup signin">\n    <div class="popus-cont">\n        <a href="javascript:;" class="close Lposa"></a>\n        <div class="c-cont"><iframe frameborder="0" scrolling="no" src="about:blank"></iframe></div>\n    </div>\n</div>',CommonCheckinCityFixedTemplate:'<div class="city_source_item Ldn">\n  <% if(data.loadUrl){%>\n    <img class="loading" src="<%= data.loadUrl %>"/>\n  <%} else if (!data.cityList){%>\n    <p class="no_city">暂不支持其他城市切换</p>\n  <% }else{%>\n    <div class="tips">热门城市(可直接输入城市或城市拼音检索)</div>\n      <div class="tabs ">\n        <div class="backbox"></div>\n          <div class="links">\n            <% _.each(data.cityList, function(cityGroup, groupIndex) { %>\n              <a href="javascript:;" class="link<%=(groupIndex === 0 ? \' active\':\'\')%>"><%=cityGroup.index %></a><% }); %>\n          </div>\n        </div>\n      <div class="tabcontainer">\n        <% _.each(data.cityList,function(cityGroup, groupIndex) { %>\n          <div class="tabcontent Lovh<%=(groupIndex != 0 ? \' Ldn\':\'\')%>">\n            <% _.each(cityGroup.citys, function(citys, citysIndex) { %>\n              <div class="group">\n                <% if (citys.char) { %><div class="char"><%=citys.char%></div><% } %>\n                  <ul class="citylist Lcfx<%=(citys.char ? \'\':\' Lmt5\')%>">\n                    <% _.each(citys.city, function(city, index){ %>\n                      <li><a href="javascript:;" data-city-id="<%=city.CityID%>" data-city-source="<%= city.Domestic === false ? 1 : city.CitySource %>" data-city-name="<%=city.CityName%>"><%=city.CityName%></a></li>\n                    <% }); %>\n                  </ul>\n              </div>\n            <% }); %>\n          </div>\n        <% }); %>\n      </div>\n  <% } %>\n</div>',userInfoTemplate:'<% if (data.MemberName) { %>\n<%\n  if(!data.Theme){\n    var themes = [\'small_purpleuser\', \'small_newpoint\', \'small_newemail\'];\n    var mask = \'<div class="mask"></div>\';\n  }else{\n    var themes = [\'small_whiteuser\', \'small_whitepoint\',\'small_whiteemail\'];\n    var mask = \'<div class="mask"></div>\';\n  }\n%>\n<div class="popuparea userinfocenter pure-u Lposr">\n<a href="javascript:;" class="myaccount Lposr"><span class="username Lposr">Hi <%-data.MemberName%><%=(data.IsAdmin && !data.IsInfoIntegrity ? \'<i class="small_redCircle"></i>\' : null)%></span><span class="userleveldesc userlevel-<%=data.MemberLevel%> <%=(data.IsForever ? \'userlevel-forever\' : \'\')%>"><%= data.MemberLevelDesc %></span><i class="Cicon small_newarrow"></i></a>\n<%if(data.IsAdmin){ %>\n  <a href="<%=data.PointUrl%>" class="mypointlink"><i class="Cicon <%=themes[1]%>"></i><span><%=data.Point%></span></a>\n<%}%>\n<a href="<%= data.NoticeUrl %>" class="mynoticelink"><i class="Cicon <%=themes[2]%>"></i><span><%= data.MemberNewSystemNoticeCount %></span></a>\n<div class="popupBox Lposa Ltal">\n  <%=mask%>\n  <ul class="Lcfx Ltac popupBox_content">\n    <li class="Lfll Ltal"><a class="Ldib" href="<%= data.MemberOrderUrl %>">我的订单</a></li>\n    <%if(data.IsAdmin){%>\n      <li class="Lfll Ltal"><a class="Ldib" href="<%=data.MemberWalletUrl %>">我的钱包</a></li>\n      <li class="Lfll Ltal"><a class="Ldib" href="<%=data.MemberWrapsUrl %>">我的券包</a></li>\n      <li class="Lfll Ltal"><a class="Ldib personInfo Lposr" href="<%= data.MemberPersonInfoUrl %>">个人中心<%=(!data.IsInfoIntegrity ? \'<i class="small_redCircle"></i>\' : null)%></a></li>\n    <%}%>\n    <li class="Lfll Ltal"><a class="Ldib" href="<%=data.SignOutUrl%>">退出</a></li>\n  </ul>\n</div>\n</div>\n<% } else {%>\n<a class="signin pure-u" href="<%=data.SignInUrl%>">登录</a>\n<a class="signup pure-u" href="<%=data.SignUpUrl%>">注册</a>\n<% } %>'},getTemplate:function(t){var a;if(this.has(t)?a=this.get(t):(a=e("#"+t).html(),this.set(t,a)),i.isString(a))return i.template(a,{variable:"data"});throw"template type error, id: "+t},renderTemplate:function(e,t){var a;return(a=this.getTemplate(e))(t)},renderStringTemplate:function(e,t){
if(i.isString(e))return i.template(e,{variable:"data"})(t);throw"template type error, template: "+e},constructor:function(){t.Model.apply(this,arguments)}}),n=t.Model.extend({defaults:{hotels:[],useCookie:!0},storageHotels:function(e){e=this.get("hotels");try{if(e.length)return this.get("useCookie")?this.storageByCookie(e):localStorage.setItem("VisitedHotel",JSON.stringify(e))}catch(t){return this.clear()}},storageByCookie:function(t){var a,n,i,s,r,o,l,c,p,d,m;for(m=4,a=[],p=Math.ceil(t.length/m),i=r=0,d=p;0<=d?r<d:r>d;i=0<=d?++r:--r)a.push(t.slice(i*m,(i+1)*m));for(e.cookie("VisitedHotelMap",a.length,{expires:30,path:"/"}),l=o=0,c=a.length;o<c;l=++o)s=a[l],n=encodeURIComponent(JSON.stringify(s)),e.cookie("VisitedHotel"+l,n,{expires:30,path:"/"});return!0},clearByCookie:function(){var t,a;for(a=t=0;t<5;a=++t)e.removeCookie("VisitedHotel"+a,{path:"/"});return e.removeCookie("VisitedHotelMap",{path:"/"}),!0},readByCookie:function(){var t,a,n,i,s,r,o;for(n=[],r=parseInt(e.cookie("VisitedHotelMap"))||0,s=i=0,o=r;0<=o?i<o:i>o;s=0<=o?++i:--i)t=e.cookie("VisitedHotel"+s),t&&(a=JSON.parse(decodeURIComponent(t)))&&(n=n.concat(a));return n},setHotel:function(e){var t,a,n;a=this.get("hotels"),t=e.HotelId,n=i.findIndex(a,{HotelId:t}),n>-1&&a.splice(n,1),a.unshift(e),a.length>10&&a.pop(),this.set({hotels:a}),this.storageHotels()},clear:function(){this.set("hotels",[]),this.get("useCookie")?this.clearByCookie():localStorage.removeItem("VisitedHotel")},initHotel:function(t){var a,n;if(!e.cookie)throw"no $.cookie";try{this.get("useCookie")?a=this.readByCookie():(n=localStorage.getItem("VisitedHotel"),n&&(a=JSON.parse(n))),a&&this.set({hotels:a})}catch(i){this.clear()}},constructor:function(){t.Model.apply(this,arguments),window.localStorage&&this.set("useCookie",!1),this.initHotel()}}),s.service("user",{instance:null,model:l,init:function(){return this.instance||(this.instance=new this.model({syncFavor:!0})),this.instance}}),s.service("search",{instance:null,model:r,init:function(){return this.instance||(this.instance=new this.model(location.search)),this.instance}}),s.service("template",{instance:null,model:o,init:function(){return this.instance||(this.instance=new this.model),this.instance}}),s.service("visitedHotel",{instance:null,model:n,init:function(){return this.instance||(this.instance=new this.model),this.instance}}),a=this.HZWeb={},s.on("initHZWebSearch",function(){return a.search=s.service("search")}),s.on("initHZWebUser",function(){return a.user=s.service("user")})}).call(this);